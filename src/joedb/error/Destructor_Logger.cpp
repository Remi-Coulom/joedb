#include "joedb/error/Destructor_Logger.h"
#include "joedb/error/CLog_Logger.h"

namespace joedb
{
 ////////////////////////////////////////////////////////////////////////////
 static Logger &get_default_logger()
 ////////////////////////////////////////////////////////////////////////////
 {
  static CLog_Logger logger("joedb destructor warning");
  return logger;
 }

 Logger *Destructor_Logger::the_logger = &get_default_logger();
 std::mutex Destructor_Logger::mutex;

 ////////////////////////////////////////////////////////////////////////////
 void Destructor_Logger::warning(const std::string &message) noexcept
 ////////////////////////////////////////////////////////////////////////////
 {
  std::unique_lock lock(mutex);
  if (the_logger)
   the_logger->log(message);
 }

 ////////////////////////////////////////////////////////////////////////////
 void Destructor_Logger::set_logger(Logger *new_logger)
 ////////////////////////////////////////////////////////////////////////////
 {
  std::unique_lock lock(mutex);
  the_logger = new_logger;
 }

 ////////////////////////////////////////////////////////////////////////////
 void Destructor_Logger::set_logger()
 ////////////////////////////////////////////////////////////////////////////
 {
  std::unique_lock lock(mutex);
  the_logger = &get_default_logger();
 }

 ////////////////////////////////////////////////////////////////////////////
 void Destructor_Logger::remove_logger()
 ////////////////////////////////////////////////////////////////////////////
 {
  std::unique_lock lock(mutex);
  the_logger = nullptr;
 }
}
