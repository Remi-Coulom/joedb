#include "Multiplexer.h"

/////////////////////////////////////////////////////////////////////////////
void joedb::Multiplexer::add_writeable(Writeable &writeable)
/////////////////////////////////////////////////////////////////////////////
{
 writeables.push_back(&writeable);
}

#define MULTIPLEX(x) do {for (auto w: writeables) w->x;} while(0)

/////////////////////////////////////////////////////////////////////////////
void joedb::Multiplexer::create_table(const std::string &name)
/////////////////////////////////////////////////////////////////////////////
{
 MULTIPLEX(create_table(name));
}

/////////////////////////////////////////////////////////////////////////////
void joedb::Multiplexer::drop_table(table_id_t table_id)
/////////////////////////////////////////////////////////////////////////////
{
 MULTIPLEX(drop_table(table_id));
}

/////////////////////////////////////////////////////////////////////////////
void joedb::Multiplexer::rename_table
/////////////////////////////////////////////////////////////////////////////
(
 table_id_t table_id,
 const std::string &name
)
{
 MULTIPLEX(rename_table(table_id, name));
}

/////////////////////////////////////////////////////////////////////////////
void joedb::Multiplexer::add_field
/////////////////////////////////////////////////////////////////////////////
(
 table_id_t table_id,
 const std::string &name,
 Type type
)
{
 MULTIPLEX(add_field(table_id, name, type));
}

/////////////////////////////////////////////////////////////////////////////
void joedb::Multiplexer::drop_field
/////////////////////////////////////////////////////////////////////////////
(
 table_id_t table_id,
 field_id_t field_id
)
{
 MULTIPLEX(drop_field(table_id, field_id));
}

/////////////////////////////////////////////////////////////////////////////
void joedb::Multiplexer::rename_field
/////////////////////////////////////////////////////////////////////////////
(
 table_id_t table_id,
 field_id_t field_id,
 const std::string &name
)
{
 MULTIPLEX(rename_field(table_id, field_id, name));
}

/////////////////////////////////////////////////////////////////////////////
void joedb::Multiplexer::custom(const std::string &name)
/////////////////////////////////////////////////////////////////////////////
{
 MULTIPLEX(custom(name));
}

/////////////////////////////////////////////////////////////////////////////
void joedb::Multiplexer::comment(const std::string &comment)
/////////////////////////////////////////////////////////////////////////////
{
 MULTIPLEX(comment(comment));
}

/////////////////////////////////////////////////////////////////////////////
void joedb::Multiplexer::timestamp(int64_t timestamp)
/////////////////////////////////////////////////////////////////////////////
{
 MULTIPLEX(timestamp(timestamp));
}

/////////////////////////////////////////////////////////////////////////////
void joedb::Multiplexer::valid_data()
/////////////////////////////////////////////////////////////////////////////
{
 MULTIPLEX(valid_data());
}

/////////////////////////////////////////////////////////////////////////////
void joedb::Multiplexer::insert
/////////////////////////////////////////////////////////////////////////////
(
 table_id_t table_id,
 record_id_t record_id
)
{
 MULTIPLEX(insert(table_id, record_id));
}

/////////////////////////////////////////////////////////////////////////////
void joedb::Multiplexer::insert_vector
/////////////////////////////////////////////////////////////////////////////
(
 table_id_t table_id,
 record_id_t record_id,
 record_id_t size
)
{
 MULTIPLEX(insert_vector(table_id, record_id, size));
}

/////////////////////////////////////////////////////////////////////////////
void joedb::Multiplexer::delete_record
/////////////////////////////////////////////////////////////////////////////
(
 table_id_t table_id,
 record_id_t record_id
)
{
 MULTIPLEX(delete_record(table_id, record_id));
}

#define TYPE_MACRO(type, return_type, type_id, R, W)\
void joedb::Multiplexer::update_##type_id\
(\
 table_id_t table_id,\
 record_id_t record_id,\
 field_id_t field_id,\
 return_type value\
)\
{\
 MULTIPLEX(update_##type_id(table_id, record_id, field_id, value));\
}\
\
void joedb::Multiplexer::update_vector_##type_id\
(\
 table_id_t table_id,\
 record_id_t record_id,\
 field_id_t field_id,\
 record_id_t size,\
 const type *value\
)\
{\
 MULTIPLEX\
 (\
  update_vector_##type_id(table_id, record_id, field_id, size, value)\
 );\
}
#include "joedb/TYPE_MACRO.h"
#undef TYPE_MACRO
#undef MULTIPLEX
