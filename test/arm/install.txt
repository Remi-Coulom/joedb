# https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Virtual_ARM_Linux_environment

#############################################################################
# Install and run (tested in Ubuntu 18.04)
#############################################################################
sudo add-apt-repository ppa:linaro-maintainers/tools

sudo apt-get install linaro-image-tools qemu-user-static qemu-system

wget https://releases.linaro.org/platform/linaro-n/nano/alpha-3/linaro-natty-nano-tar-20110302-0.tar.gz

wget https://releases.linaro.org/platform/linaro-n/hwpacks/alpha-3/hwpack_linaro-vexpress_20110302-0_armel_supported.tar.gz

linaro-media-create --rootfs ext2 --image_file vexpress.img --dev vexpress --binary linaro-natty-nano-tar-20110302-0.tar.gz --hwpack hwpack_linaro-vexpress_20110302-0_armel_supported.tar.gz

sudo mount -o loop,offset="$(file vexpress.img | awk 'BEGIN { RS=";"; } /partition 2/ { print $10*512; }')" -t auto vexpress.img /mnt/tmp

cp /mnt/tmp/vmlinuz .
cp /mnt/tmp/initrd.img .

qemu-system-arm -M vexpress-a9 -cpu cortex-a9 -kernel ./vmlinuz \
  -initrd ./initrd.img -redir tcp:2200::22 -m 512 \
  -append "root=/dev/mmcblk0p2 vga=normal mem=512M devtmpfs.mount=0 rw" \
  -drive file=vexpress.img,if=sd,cache=writeback

#############################################################################
# Configure virtual machine (ssh, user, ...)
#############################################################################
ifconfig eth0 up
dhclient eth0

vi /etc/apt/sources.list #ports.ubuntu.com -> old-releases.ubuntu.com
apt-get install openssh-server

# doesn't work. giving up
